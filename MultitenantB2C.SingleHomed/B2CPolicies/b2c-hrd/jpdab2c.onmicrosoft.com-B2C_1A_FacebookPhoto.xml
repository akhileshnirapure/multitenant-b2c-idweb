<TrustFrameworkPolicy xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
    xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06" PolicySchemaVersion="0.3.0.0" TenantId="jpdab2c.onmicrosoft.com" PolicyId="B2C_1A_FacebookClaimsProvider" PublicPolicyUri="http://jpdab2c.onmicrosoft.com/B2C_1A_AADCommonClaimsProvider" TenantObjectId="0b6270a6-46b8-4c8b-8f45-265f396bb543">
    <BasePolicy>
        <TenantId>jpdab2c.onmicrosoft.com</TenantId>
        <PolicyId>B2C_1A_TrustFrameworkExtensions</PolicyId>
    </BasePolicy>
    <BuildingBlocks>
        <ClaimsSchema>
            <ClaimType Id="avatar">
                <DisplayName>Avatar</DisplayName>
                <DataType>string</DataType>
                <UserHelpText/>
            </ClaimType>
            <ClaimType Id="avatarURL">
                <DisplayName>AvatarURL</DisplayName>
                <DataType>string</DataType>
                <UserHelpText/>
            </ClaimType>
        </ClaimsSchema>
        <ClaimsTransformation Id="GetAvatarURLFromJSON" TransformationMethod="GetClaimFromJson">
            <InputClaims>
                <InputClaim ClaimTypeReferenceId="avatar" TransformationClaimType="inputJson" />
            </InputClaims>
            <InputParameters>
                <InputParameter Id="claimToExtract" DataType="string" Value="data.url" />
            </InputParameters>
            <OutputClaims>
                <OutputClaim ClaimTypeReferenceId="avatarURL" TransformationClaimType="extractedClaim" />
            </OutputClaims>
        </ClaimsTransformation>
    </BuildingBlocks>
    <ClaimsProviders>
        <ClaimsProvider>
            <Domain>facebook.com</Domain>
            <DisplayName>Facebook</DisplayName>
            <TechnicalProfiles>
                <TechnicalProfile Id="Facebook-OAUTH">
                    <OutputClaims>
                        <OutputClaim ClaimTypeReferenceId="authenticationSource" DefaultValue="socialIdpAuthentication" AlwaysUseDefaultValue="true" />
                        <OutputClaim ClaimTypeReferenceId="identityProvider" DefaultValue="facebook.com" AlwaysUseDefaultValue="true" />
                        <OutputClaim ClaimTypeReferenceId="identityProviderAccessToken" PartnerClaimType="{oauth2:access_token}" />
                        <OutputClaim ClaimTypeReferenceId="issuerUserId" PartnerClaimType="id" />
                        <OutputClaim ClaimTypeReferenceId="email" PartnerClaimType="email" />
                        <OutputClaim ClaimTypeReferenceId="displayName" PartnerClaimType="name" />
                        <OutputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="first_name" />
                        <OutputClaim ClaimTypeReferenceId="surname" PartnerClaimType="last_name" />
                        <OutputClaim ClaimTypeReferenceId="avatar" PartnerClaimType="picture" />
                    </OutputClaims>
                    <OutputClaimsTransformations>
                        <OutputClaimsTransformation ReferenceId="CreateRandomUPNUserName" />
                        <OutputClaimsTransformation ReferenceId="CreateUserPrincipalName" />
                        <OutputClaimsTransformation ReferenceId="CreateAlternativeSecurityId" />
                        <!-- Here's my claims transformer: -->
                        <OutputClaimsTransformation ReferenceId="GetAvatarURLFromJSON" />
                    </OutputClaimsTransformations>
                </TechnicalProfile>
            </TechnicalProfiles>
        </ClaimsProvider>
    </ClaimsProviders>
</TrustFrameworkPolicy>